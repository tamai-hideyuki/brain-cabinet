# Notionãƒ©ã‚¤ã‚¯ ãƒ–ãƒ­ãƒƒã‚¯ã‚¨ãƒ‡ã‚£ã‚¿

> UIå°‚ç”¨ã®Notionãƒ©ã‚¤ã‚¯ãªãƒ–ãƒ­ãƒƒã‚¯ã‚¨ãƒ‡ã‚£ã‚¿å®Ÿè£…

---

## æ¦‚è¦

- **ç›®çš„**: ãƒãƒ¼ãƒˆè©³ç´°ç”»é¢ã§Notionã®ã‚ˆã†ãªç›´æ„Ÿçš„ãªç·¨é›†ä½“é¨“ã‚’æä¾›
- **ãƒ‡ãƒ¼ã‚¿ä¿å­˜**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å¤‰æ›´ãªã—ã€‚ç·¨é›†ã¯ãƒ–ãƒ­ãƒƒã‚¯å½¢å¼ã€ä¿å­˜æ™‚ã«Markdownã«å¤‰æ›
- **è‡ªå‹•ä¿å­˜**: 1.5ç§’ã®ãƒ‡ãƒã‚¦ãƒ³ã‚¹ä»˜ãè‡ªå‹•ä¿å­˜

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
ui/src/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ block.ts                    # ãƒ–ãƒ­ãƒƒã‚¯å‹å®šç¾©
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ atoms/
â”‚   â”‚   â””â”€â”€ BlockEditable/          # contenteditable ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”œâ”€â”€ molecules/
â”‚   â”‚   â”œâ”€â”€ SlashCommandMenu/       # ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼
â”‚   â”‚   â””â”€â”€ InlineFormatToolbar/    # ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ›¸å¼ãƒ„ãƒ¼ãƒ«ãƒãƒ¼
â”‚   â””â”€â”€ organisms/
â”‚       â””â”€â”€ BlockEditor/
â”‚           â”œâ”€â”€ BlockEditor.tsx     # ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ‡ã‚£ã‚¿
â”‚           â”œâ”€â”€ BlockEditor.css
â”‚           â”œâ”€â”€ BlockEditorContext.tsx
â”‚           â”œâ”€â”€ hooks/
â”‚           â”‚   â”œâ”€â”€ useBlockEditor.ts
â”‚           â”‚   â”œâ”€â”€ useKeyboardShortcuts.ts
â”‚           â”‚   â”œâ”€â”€ useSlashCommand.ts
â”‚           â”‚   â”œâ”€â”€ useBlockDragDrop.ts
â”‚           â”‚   â””â”€â”€ useTextSelection.ts
â”‚           â”œâ”€â”€ blocks/
â”‚           â”‚   â”œâ”€â”€ TextBlock.tsx
â”‚           â”‚   â”œâ”€â”€ HeadingBlock.tsx
â”‚           â”‚   â”œâ”€â”€ BulletListBlock.tsx
â”‚           â”‚   â”œâ”€â”€ NumberedListBlock.tsx
â”‚           â”‚   â”œâ”€â”€ ChecklistBlock.tsx
â”‚           â”‚   â”œâ”€â”€ CodeBlockEditor.tsx
â”‚           â”‚   â”œâ”€â”€ QuoteBlock.tsx
â”‚           â”‚   â”œâ”€â”€ ToggleBlock.tsx
â”‚           â”‚   â”œâ”€â”€ ImageBlock.tsx
â”‚           â”‚   â”œâ”€â”€ DividerBlock.tsx
â”‚           â”‚   â”œâ”€â”€ TableBlock.tsx
â”‚           â”‚   â””â”€â”€ index.ts
â”‚           â””â”€â”€ utils/
â”‚               â”œâ”€â”€ markdownToBlocks.ts
â”‚               â”œâ”€â”€ blocksToMarkdown.ts
â”‚               â””â”€â”€ blockOperations.ts
```

---

## ãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ—

| ã‚¿ã‚¤ãƒ— | èª¬æ˜ | ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ |
|--------|------|------------------|
| `text` | ãƒ†ã‚­ã‚¹ãƒˆ | `/text` |
| `heading1` | è¦‹å‡ºã—1 | `/h1` |
| `heading2` | è¦‹å‡ºã—2 | `/h2` |
| `heading3` | è¦‹å‡ºã—3 | `/h3` |
| `bulletList` | ç®‡æ¡æ›¸ã | `/bullet` |
| `numberedList` | ç•ªå·ä»˜ããƒªã‚¹ãƒˆ | `/number` |
| `checklist` | ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ | `/todo` |
| `code` | ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ | `/code` |
| `quote` | å¼•ç”¨ | `/quote` |
| `toggle` | ãƒˆã‚°ãƒ« | `/toggle` |
| `image` | ç”»åƒ | `/image` |
| `divider` | åŒºåˆ‡ã‚Šç·š | `/divider` |
| `table` | ãƒ†ãƒ¼ãƒ–ãƒ« | `/table` |

---

## ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ

| ã‚­ãƒ¼ | å‹•ä½œ |
|------|------|
| `Enter` | æ–°ã—ã„ãƒ–ãƒ­ãƒƒã‚¯ä½œæˆ / ãƒ–ãƒ­ãƒƒã‚¯åˆ†å‰² |
| `Backspace` (å…ˆé ­) | å‰ã®ãƒ–ãƒ­ãƒƒã‚¯ã¨ãƒãƒ¼ã‚¸ / ãƒ†ã‚­ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã«å¤‰æ› |
| `Tab` | ãƒªã‚¹ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ |
| `Shift+Tab` | ãƒªã‚¹ãƒˆã®ã‚¢ã‚¦ãƒˆãƒ‡ãƒ³ãƒˆ |
| `â†‘/â†“` | ãƒ–ãƒ­ãƒƒã‚¯é–“ç§»å‹• |
| `Cmd+B` | å¤ªå­— |
| `Cmd+I` | ã‚¤ã‚¿ãƒªãƒƒã‚¯ |
| `Cmd+S` | ä¿å­˜ |
| `/` | ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º |

---

## ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ›¸å¼

ãƒ†ã‚­ã‚¹ãƒˆã‚’é¸æŠã™ã‚‹ã¨ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã€ä»¥ä¸‹ã®æ›¸å¼ã‚’é©ç”¨å¯èƒ½:

| ãƒœã‚¿ãƒ³ | æ›¸å¼ | Markdown |
|--------|------|----------|
| **B** | å¤ªå­— | `**text**` |
| *I* | ã‚¤ã‚¿ãƒªãƒƒã‚¯ | `*text*` |
| `</>` | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰ | `` `text` `` |
| ğŸ”— | ãƒªãƒ³ã‚¯ | `[text](url)` |

### æŠ€è¡“å®Ÿè£…

- `InlineFormatToolbar`: é¸æŠæ™‚ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ãƒãƒ¼
- `useTextSelection`: é¸æŠç¯„å›²ã®æ¤œå‡ºãƒ•ãƒƒã‚¯
- `marks`: å„ãƒ–ãƒ­ãƒƒã‚¯ã« `InlineMark[]` ã¨ã—ã¦æ›¸å¼æƒ…å ±ã‚’ä¿æŒ
- `applyMark` / `removeMark`: marksã®è¿½åŠ ãƒ»å‰Šé™¤æ“ä½œ

---

## ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—

- å„ãƒ–ãƒ­ãƒƒã‚¯ã®å·¦ç«¯ã«ãƒ‰ãƒ©ãƒƒã‚°ãƒãƒ³ãƒ‰ãƒ«ï¼ˆâ‹®â‹®ï¼‰ã‚’è¡¨ç¤º
- ãƒ‰ãƒ©ãƒƒã‚°ã§ä¸¦ã¹æ›¿ãˆå¯èƒ½
- ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ã«ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼è¡¨ç¤º

---

## å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯

### Markdown â†’ Blocks (`markdownToBlocks.ts`)

- `unified` + `remark-parse` + `remark-gfm` ã§Markdownã‚’ASTã«ãƒ‘ãƒ¼ã‚¹
- ASTãƒãƒ¼ãƒ‰ã‚’Blockã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ›¸å¼ï¼ˆbold, italic, code, linkï¼‰ã‚’marksé…åˆ—ã«æŠ½å‡º

### Blocks â†’ Markdown (`blocksToMarkdown.ts`)

- å„ãƒ–ãƒ­ãƒƒã‚¯ã‚’Markdownæ–‡å­—åˆ—ã«å¤‰æ›
- marksã‚’é©ç”¨ã—ã¦æ›¸å¼è¨˜å·ã‚’æŒ¿å…¥
- ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒˆã‚°ãƒ«ï¼ˆ`<details>`ï¼‰ãªã©ç‰¹æ®Šå½¢å¼ã«å¯¾å¿œ

---

## ä½¿ç”¨ç®‡æ‰€

### ãƒãƒ¼ãƒˆè©³ç´°ç”»é¢ (`NoteDetailPage`)

- `NoteDetail` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã« `BlockEditor` ã‚’çµ±åˆ
- ç·¨é›†å†…å®¹ã¯1.5ç§’ãƒ‡ãƒã‚¦ãƒ³ã‚¹å¾Œã«è‡ªå‹•ä¿å­˜
- ä¿å­˜çŠ¶æ…‹ã‚’ã€Œä¿å­˜ä¸­...ã€ã€Œä¿å­˜ã—ã¾ã—ãŸã€ã§è¡¨ç¤º
- ã€ŒMarkdownç·¨é›†ã€ãƒœã‚¿ãƒ³ã§å¾“æ¥ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ç·¨é›†ã‚‚å¯èƒ½

---

## å‹å®šç¾© (`ui/src/types/block.ts`)

```typescript
export type BlockType =
  | 'text' | 'heading1' | 'heading2' | 'heading3'
  | 'bulletList' | 'numberedList' | 'checklist'
  | 'code' | 'quote' | 'toggle'
  | 'image' | 'divider' | 'table'

export type MarkType = 'bold' | 'italic' | 'code' | 'link'

export interface InlineMark {
  type: MarkType
  start: number
  end: number
  url?: string
}

export interface BaseBlock {
  id: string
  type: BlockType
  indent: number
}

// å„ãƒ–ãƒ­ãƒƒã‚¯å‹ï¼ˆTextBlock, HeadingBlock, etc.ï¼‰
// Block = union of all block types
// EditorState = { blocks, focusedBlockId, cursorPosition, selectedBlockIds }
```

---

## å®Ÿè£…çŠ¶æ³

| ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | çŠ¶æ…‹ |
|---------|------|------|
| Phase 1 | åŸºç›¤æ§‹ç¯‰ï¼ˆå‹å®šç¾©ã€å¤‰æ›ã€çŠ¶æ…‹ç®¡ç†ï¼‰ | å®Œäº† |
| Phase 2 | åŸºæœ¬ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆtext, heading, divider, quoteï¼‰ | å®Œäº† |
| Phase 3 | ãƒªã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ï¼ˆbullet, numbered, checklistï¼‰ | å®Œäº† |
| Phase 4 | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ›¸å¼ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ | å®Œäº†ï¼ˆä¸€éƒ¨å‹•ä½œç¢ºèªå¿…è¦ï¼‰ |
| Phase 5 | é«˜åº¦ãªãƒ–ãƒ­ãƒƒã‚¯ï¼ˆcode, image, toggle, tableï¼‰ | å®Œäº† |
| Phase 6 | ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ï¼†ãƒ‰ãƒ©ãƒƒã‚° | å®Œäº† |
| Phase 7 | è©³ç´°ç”»é¢çµ±åˆï¼†è‡ªå‹•ä¿å­˜ | å®Œäº† |

---

## æ—¢çŸ¥ã®åˆ¶é™ãƒ»ä»Šå¾Œã®èª²é¡Œ

- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æ›¸å¼ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‹•ä½œæ¤œè¨¼ãŒå¿…è¦
- æ—¥æœ¬èªIMEå…¥åŠ›æ™‚ã®Enterç¢ºå®šã§ãƒ–ãƒ­ãƒƒã‚¯ãŒæ¶ˆãˆã‚‹å•é¡Œã¯ä¿®æ­£æ¸ˆã¿
- ç•ªå·ä»˜ããƒªã‚¹ãƒˆã®é€£ç•ªè¨ˆç®—ã¯åŒä¸€ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«å†…ã§æ­£ã—ãå‹•ä½œ

---

æœ€çµ‚æ›´æ–°: 2026-01-22
